/*!
* country-region-selector
* ------------------------
* 1.0.0
* @author Ben Keen
* @repo https://github.com/benkeen/country-region-selector
* @licence MIT
*/

!function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("object"==typeof exports)try{module.exports=t(require())}catch(e){module.exports=t()}else e.crs=t()}(this,function(){"use strict";var p=!0,g=!0,v=[],o=[["China","CN","Anhui~34|Beijing~11|Chongqing~50|Fujian~35|Gansu~62|Guangdong~44|Guangxi~45|Guizhou~52|Hainan~46|Hebei~13|Heilongjiang~23|Henan~41|Hong Kong~91|Hubei~42|Hunan~43|Inner Mongolia~15|Jiangsu~32|Jiangxi~36|Jilin~22|Liaoning~21|Macau~92|Ningxia~64|Qinghai~63|Shaanxi~61|Shandong~37|Shanghai~31|Shanxi~14|Sichuan~51|Tianjin~12|Tibet~54|Xinjiang~65|Yunnan~53|Zhejiang~33"],["Hong Kong","HK","Hong Kong"],["Macao","MO","Macao"],["Taiwan","TW","Changhua~CHA|Chiai~CYQ|Hsinchu~HSQ|Hualien~HUA|Kaohsiung~KHH|Keelung~KEE|Kinmen~KIN|Lienchiang~LIE|Miaoli~MIA|Nantou~NAN|Peng-hu~PEN|New Taipei~NWT|Pingchung~PIF|Taichung~TXG|Tainan~TNN|Taipei~TPE|Taitung~TTT|Taoyuan~TAO|Yilan~ILA|Yunlin~YUN"]],e=function(){$(".crs-country").each(t)},t=function(){var e=this;if("true"!==e.getAttribute("data-crs-loaded")){e.length=0;var t=$(e).attr("data-default-option"),n=t||"Select country",i=e.getAttribute("data-show-default-option");p=null===i||"true"===i;var a=$(e).attr("data-default-value"),r=$(e).attr("data-value"),o=0;p&&(this.options[0]=new Option(n,"")),x({whitelist:e.getAttribute("data-whitelist"),blacklist:e.getAttribute("data-blacklist"),preferred:e.getAttribute("data-preferred"),preferredDelim:e.getAttribute("data-preferred-delim")});for(var s=0;s<v.length;s++){var l="shortcode"==r||"2-char"===r?v[s][1]:v[s][0];v[s][4]&&(l=""),e.options[e.length]=new Option(v[s][0],l),null!=a&&a===l&&(o=s,p&&o++)}this.selectedIndex=o;var u=$(e).attr("data-region-id");if(u){var d=$("#"+u)[0];if(d)if(b(d),$(this).on("change",function(){w(e,d)}),a&&0<e.selectedIndex){w(e,d);var g=$(d).attr("data-default-value"),h="shortcode"===d.getAttribute("data-value");if(null!==g){var c=p?e.selectedIndex-1:e.selectedIndex,f=v[c][3];T(d,f,g,h)}}else!1===p&&w(e,d);else console.error("Region dropdown DOM node with ID "+u+" not found.");e.setAttribute("data-crs-loaded","true")}else console.error("Missing data-region-id on country-region-selector country field.")}},b=function(e){var t=$(e).attr("data-blank-option"),n=t||"-",i=e.getAttribute("data-show-default-option");g=null===i||"true"===i,e.length=0,g&&(e.options[0]=new Option(n,""),e.selectedIndex=0)},x=function(e){var t=o,n=[],i=0;if(e.whitelist){var a=e.whitelist.split(",");for(i=0;i<o.length;i++)-1!==a.indexOf(o[i][1])&&n.push(o[i]);t=n}else if(e.blacklist){var r=e.blacklist.split(",");for(i=0;i<o.length;i++)-1===r.indexOf(o[i][1])&&n.push(o[i]);t=n}e.preferred&&(t=l(t,e.preferred,e.preferredDelim)),v=t,s()},s=function(){for(var e=0;e<v.length;e++){for(var t={hasShortcodes:/~/.test(v[e][2]),regions:[]},n=v[e][2].split("|"),i=0;i<n.length;i++){var a=n[i].split("~");t.regions.push([a[0],a[1]])}v[e][3]=t}},T=function(e,t,n,i){for(var a=0;a<t.regions.length;a++){if((i&&t.hasShortcodes&&t.regions[a][1]?t.regions[a][1]:t.regions[a][0])===n){e.selectedIndex=g?a+1:a;break}}},w=function(e,t){var n=p?e.selectedIndex-1:e.selectedIndex,i=$(t).attr("data-default-option"),a=t.getAttribute("data-value"),r=i||"Select region";if(""===e.value)b(t);else{t.length=0,g&&(t.options[0]=new Option(r,""));var o=v[n][3],s="shortcode"===a&&o.hasShortcodes,l=s?1:0;o.regions.sort(function(e,t){var n=e[l].toLowerCase(),i=t[l].toLowerCase();return n<i?-1:i<n?1:0});for(var u=0;u<o.regions.length;u++){var d=s?o.regions[u][1]:o.regions[u][0];t.options[t.length]=new Option(o.regions[u][0],d)}t.selectedIndex=0}},l=function(e,t,n){var i=t.split(",").reverse(),a={},r=!1,o=e.filter(function(e){return-1===i.indexOf(e[1])||(a[e[1]]=e,!(r=!0))});r&&n&&o.unshift([n,"","",{},!0]);for(var s=0;s<i.length;s++){var l=i[s];o.unshift(a[l])}return o};return $(e),{init:e}});